{% extends "base.html" %}

{% block title %}
Applications
{% endblock %}

{% block content %}

<div class="min-h-screen bg-bg text-text-primary py-12">
    <div class="max-w-6xl mx-auto bg-surface p-8 rounded-xl border border-border">

        <h1 class="text-3xl font-bold text-primary mb-6">
            Applications for Your Job Posts
        </h1>

        {% if applications %}
        <div class="space-y-6">

            {% for app in applications %}
            <div class="p-6 bg-bg border border-border rounded-xl">

                <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                    
                    <!-- Application Info -->
                    <div>
                        <h2 class="text-xl font-semibold text-primary">
                            {{ app.job.title }}
                        </h2>

                        <p class="text-text-secondary text-sm mt-1">
                            Applicant: {{ app.applicant.username }}
                        </p>

                        <p class="text-text-secondary text-xs mt-1">
                            Applied: {{ app.applied_at|date:"F j, Y" }}
                        </p>

                        <a href="{{ app.resume.url }}"
                           class="mt-2 inline-block text-accent hover:underline text-sm">
                           View Resume
                        </a>
                    </div>

                    <!-- Current Status -->
                    <div class="flex items-center gap-3">
                        {% if app.status == "pending" %}
                        <span class="px-3 py-1 rounded-md bg-surface border border-border text-text-secondary text-sm">
                            Pending
                        </span>
                        {% elif app.status == "accepted" %}
                        <span class="px-3 py-1 rounded-md bg-green-700/20 border border-green-700 text-green-400 text-sm">
                            Accepted
                        </span>
                        {% elif app.status == "rejected" %}
                        <span class="px-3 py-1 rounded-md bg-error/20 border border-error text-error text-sm">
                            Rejected
                        </span>
                        {% endif %}
                    </div>

                </div>

                <!-- Update Status Form -->
                <form method="post" action="{% url 'update_application_status' app.id %}" class="mt-5">
                    {% csrf_token %}

                    <label class="block text-sm mb-2 font-medium">Update Status</label>

                    <select name="status"
                        class="bg-bg border border-border text-text-primary px-4 py-2 rounded-lg w-full md:w-64">
                        <option value="pending" {% if app.status == "pending" %}selected{% endif %}>Pending</option>
                        <option value="reviewed" {% if app.status == "reviewed" %}selected{% endif %}>Reviewed</option>
                        <option value="accepted" {% if app.status == "accepted" %}selected{% endif %}>Accepted</option>
                        <option value="rejected" {% if app.status == "rejected" %}selected{% endif %}>Rejected</option>
                    </select>

                    <button
                        class="mt-3 px-5 py-2 bg-primary text-white rounded-lg font-semibold hover:bg-primary/80">
                        Update
                    </button>
                </form>

            </div>
            {% endfor %}
        </div>

        {% else %}
        <div class="text-center py-20">
            <p class="text-text-secondary text-lg">No applications have been submitted yet.</p>
        </div>
        {% endif %}
    </div>
</div>

{% endblock %}
